# Table‑Graph Toolkit

Набор из **двух небольших вспомогательных скриптов** для личного использования, не рассчитан на использование в других местах:

| Файл                      | Назначение |
|---------------------------|------------|
| **`parse_word_files.py`** | Читает все Word‑документы из `DOC_DIR`, извлекает описания таблиц, строит **неориентированный** граф `NetworkX` и сохраняет в `graph.pickle`. У каждого узла хранится атрибут `def_file` — имя DOCX, где встретился заголовок «Таблица …» + «Название в базе …». |
| **`find.py`**             | Работает поверх готового pickle‑графа: <br>• если заданы **A и B** — выводит до *М* кратчайших путей A → … → B; <br>• если указан только **A** — показывает всех соседей A **с указанием файла**, где описана каждая соседняя таблица. |

---

## Установка

```bash
pip install requirements.txt
pyinstaller --onefile find.py
```

---

## Быстрая работа

### 1 · Построить (или обновить) граф

```bash
python parse_graph.py          # создаст graph.pickle и caption_map.json
```

> При каждом новом пакете Word‑файлов повторите этот шаг — файл pickle перезапишется.

### 2 · Посмотреть, «куда можно уйти» из таблицы

```bash
find.py employeepost_t
```

```
Из employeepost_t можно уйти в (3):
  • employee_t              файл: HR_module.docx
  • department_t            файл: Dept_module.docx
  • salarygrade_t           файл: Payroll.docx
```

### 3 · Найти пути A → B

```bash
find.py employeepost_t employee_t       \
                     --maxlen   12                   \
                     --maxpaths 50                   \
                     --exclude  temp_t backup_t
```

*Скрипт выведет до 50 кратчайших путей длиной ≤ 12 узлов, пропуская
`temp_t` и `backup_t`.*

---

## Аргументы `find.py`

| Ключ | Значение по‑умолчанию | Описание                                                                                 |
|------|-----------------------|------------------------------------------------------------------------------------------|
| `source` | —                     | Обязательный. Таблица‑источник (имя в базе).                                             |
| `target` | *не задан*            | Таблица‑назначение. Если пропущен, скрипт работает в режиме «показать соседей».          |
| `--graph` | `graph.pickle`        | Путь к файлу с графом.                                                                   |
| `--maxlen` | `10`                  | Максимальное допустимое число узлов в пути (при поиске A→B). Может работать не стабильно |
| `--maxpaths` | `5`                   | Сколько первых путей печатать.                                                           |
| `-x, --exclude` | —                     | Список таблиц, которые полностью исключаются из графа перед поиском.                     |

---

## Формат выходных файлов
* `graph.pickle` — обычный Python‑pickle: `nx.Graph` c атрибутом
  `def_file` у каждого узла.
* `caption_map.json` — пригодится, если нужно сопоставлять русские
  названия и имена в БД в сторонних инструментах.

---

## Автор
Ипатов Тимофей
